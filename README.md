# Bitsave

Bitsave is a Solidity smart contract system that implements a variable interest/reward formula (the "bitsave protocol") to reward users with points that adjust dynamically according to market conditions.

The structure ensures no central pool to further protect user's funds using a (Parent-Child) facZ

This repo contains the smart contracts, scripts, and tests used for development with Foundry. The contract has been deployed to the Hedera testnet — see the deployment section below.

## Hedera deployment

- Network: Hedera Testnet
- Contract ID / Address: 0.0.7141595 / 0x2f33f1f07f6e56c11fd48a4f3596d9dadfe67409
- Explorer: https://hashscan.io/testnet/contract/0.0.7141595

If you want to inspect transactions or the on-chain bytecode, open the link above.

## Repository layout

- `src/` — Solidity contracts (including `Bitsave.sol`, `ChildContract.sol`, `Create2.sol`, and `Config.sol`).
- `libraries/` — shared Solidity libraries (e.g., `bitsaveHelperLib.sol`).
- `script/` and `scripts-hardhat/` — deployment and helper scripts.
- `test/` — Foundry tests written in Solidity/Forge.
- `broadcast/` — recorded script runs produced by Forge.
- `bitsave_bytecode.txt` — generated bytecode for the contract (if present).

## Quickstart (development)

This project uses Foundry for building and testing. On macOS with `zsh`, the basic workflow is:

1. Install Foundry (if not already):

```bash
curl -L https://foundry.paradigm.xyz | bash
foundryup
```

2. Build the contracts:

```bash
forge build
```

3. Run tests:

```bash
forge test
```

4. Format:

```bash
forge fmt
```

5. Run a local node for fast iteration (Anvil):

```bash
anvil
```

## Deploying

There are two different flows in this repo: an EVM-style flow using Foundry/Hardhat and the Hedera-specific deployment used for the current testnet address. The included `script/` and `scripts-hardhat/` folder contain Hardhat/Forge deployment examples.

Example Foundry script invocation (Ethereum-compatible RPC):

```bash
forge script script/Bitsave.s.sol:BitsaveScript --rpc-url <RPC_URL> --private-key <PRIVATE_KEY> --broadcast
```

For Hedera, deployments and interactions often require a Hedera-specific RPC or SDK (e.g., Hedera Hashgraph SDKs) and the network uses account/contract IDs rather than standard Ethereum addresses. The contract in this repo was deployed to Hedera testnet and is available at the Hashscan link above.

Notes about Hedera usage:
- If you plan to deploy or interact with this contract on Hedera, ensure you use a compatible gateway or an EVM-compatible node (Hedera provides an EVM interface) and the correct chain ID for Hedera testnet.

## Interacting with the deployed contract

You can interact with the contract using any EVM-compatible tools (if your provider supports Hedera EVM endpoints) or with Hedera SDKs that target the EVM interface. Example approaches:

- Use `cast` with an EVM-compatible Hedera RPC endpoint (if available):

```bash
cast send --rpc-url <HEDERA_EVM_RPC> --private-key <KEY> 0.0.7141595 "methodName(argTypes)(returnTypes)" <args>
```

- For programmatic interaction, use the Hedera JavaScript or Java SDKs configured for the EVM (or use an RPC gateway that exposes Hedera EVM endpoints).

## Examples — common function calls (cast & ethers.js)

Notes on permissions and flow:

- `joinBitsave`, `createSaving`, `incrementSaving`, and `withdrawSaving` are intended to be called by end users (their behavior often depends on `msg.sender`).
- Some functions are restricted:
	- `fromABitsaveChildOnly` modifier: certain functions (like `sendAsOriginalToken`) can only be called by the user's child contract.
	- `inhouseOnly` modifier: admin-only actions (e.g., `editFees`, `dripFountain`) require the `masterAddress` private key.

## Important files

- `src/Bitsave.sol` — main contract logic.
- `src/ChildContract.sol` — auxiliary child contract(s).
- `libraries/bitsaveHelperLib.sol` — helper math & utilities.
- `bitsave_bytecode.txt` — built bytecode snapshot (useful for on-chain verification / comparisons).
- `sourcify-package-tmp/metadata.json` — metadata for sourcify/verification packaging.

## Tests

Tests are written for Foundry/Forge in the `test/` folder. Run them with:

```bash
forge test
```

If you add or modify tests, keep them fast and deterministic. Include a happy path plus at least one edge-case test when adding new public behavior.

## Notes & troubleshooting

- This repository mixes tooling patterns (Foundry + Hardhat + Hedera deployment artifacts). Pick the toolchain that best matches your target network before deploying.
- If you need to verify the contract on-chain or via a block explorer, the `sourcify-package-tmp/` and `metadata.json` files may help create a verification package.

## Contributing

Contributions are welcome. When opening PRs, include tests and check `forge test` passes locally.

## License

This project is released under the terms of the repository [LICENSE](./LICENSE) file.